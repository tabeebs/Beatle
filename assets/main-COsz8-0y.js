(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const o={currentSong:{id:"demo-song-001",title:"Tumi Robe Nirobe",artist:"Rabindranath Tagore",soundcloudUrl:null,audioElement:null},snippetLengths:[2,3,5,8,16],currentSnippetIndex:0,currentTurn:0,maxTurns:5,guessedSongs:[],status:"playing",gameStartTime:null,gameEndTime:null,isPlaying:!1,playedSongIds:[]},u={currentAudio:null,isLoaded:!1,duration:0,snippetTimeoutId:null,progressIntervalId:null,isVictoryMode:!1,init(){this.currentAudio=new Audio,this.currentAudio.preload="metadata",this.currentAudio.addEventListener("loadedmetadata",()=>{this.duration=this.currentAudio.duration,this.isLoaded=!0,console.log(`Audio loaded: ${this.duration}s duration`)}),this.currentAudio.addEventListener("error",e=>{console.error("Audio loading error:",e),this.isLoaded=!1}),this.currentAudio.addEventListener("ended",()=>{this.stopPlayback()}),this.currentAudio.addEventListener("timeupdate",()=>{this.updateProgress()}),console.log("Audio manager initialized")},loadAudio(e){return this.currentAudio||this.init(),console.log("Loading audio:",e),this.currentAudio.src=e,this.isLoaded=!1,new Promise((t,n)=>{const s=()=>{this.currentAudio.removeEventListener("loadedmetadata",s),this.currentAudio.removeEventListener("error",i),t()},i=r=>{this.currentAudio.removeEventListener("loadedmetadata",s),this.currentAudio.removeEventListener("error",i),n(r)};this.currentAudio.addEventListener("loadedmetadata",s),this.currentAudio.addEventListener("error",i)})},playSegment(e=0,t=null,n=!1){if(!this.currentAudio||!this.isLoaded)return console.warn("Audio not loaded"),!1;this.clearTimers(),this.isVictoryMode=n,this.currentAudio.currentTime=e;const s=this.currentAudio.play();return s&&s.then(()=>{console.log(`Playing audio from ${e}s for ${t||"full"}s (Victory: ${n})`),o.isPlaying=!0,t&&!n&&(this.startProgressTracking(t),this.snippetTimeoutId=setTimeout(()=>{this.stopPlayback()},t*1e3))}).catch(i=>{console.error("Audio play failed:",i),o.isPlaying=!1}),!0},startProgressTracking(e){const t=document.getElementById("progress-fill");if(!t)return;const n=this.currentAudio.currentTime,s=16;this.progressIntervalId=setInterval(()=>{if(!this.currentAudio||this.currentAudio.paused){this.clearProgressTracking();return}const i=this.currentAudio.currentTime-n,r=Math.min(i/s,e/s)*100;t.style.width=`${r}%`},50)},clearProgressTracking(){this.progressIntervalId&&(clearInterval(this.progressIntervalId),this.progressIntervalId=null)},updateProgress(){},clearTimers(){this.snippetTimeoutId&&(clearTimeout(this.snippetTimeoutId),this.snippetTimeoutId=null),this.clearProgressTracking()},stopPlayback(){if(this.currentAudio){this.currentAudio.pause(),o.isPlaying=!1,this.clearTimers();const e=document.getElementById("vinyl-disc"),t=e==null?void 0:e.querySelector(".vinyl-center"),n=t==null?void 0:t.querySelector(".play-pause-icon");if(e&&e.classList.remove("spinning"),t&&t.classList.remove("playing"),n&&n.classList.remove("playing"),!this.isVictoryMode){const s=document.getElementById("progress-fill");s&&(s.style.width="0%")}console.log("Audio playback stopped and vinyl visual state updated")}},pause(){this.currentAudio&&!this.currentAudio.paused&&(this.currentAudio.pause(),o.isPlaying=!1,this.clearTimers(),console.log("Audio playback paused"))},resume(){if(this.currentAudio&&this.currentAudio.paused){const e=this.currentAudio.play();e&&e.then(()=>{o.isPlaying=!0,console.log("Audio playback resumed")}).catch(t=>{console.error("Audio resume failed:",t)})}},isPlaying(){return this.currentAudio&&!this.currentAudio.paused}};let g=[];async function he(){try{console.log("Loading song database...");const e=await fetch("/assets/songs/song_metadata.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);g=await e.json(),console.log(`Song database loaded: ${g.length} songs available`);const t=g.filter(n=>n.id&&n.title&&n.artist&&n.filename);return t.length!==g.length&&console.warn(`${g.length-t.length} songs have invalid metadata`),t}catch(e){return console.error("Failed to load song database:",e),console.log("Falling back to mock song data"),[{id:"demo-song-001",title:"Demo Song",artist:"Demo Artist",filename:"demo.mp3"}]}}async function te(e=!0){if(g.length===0)return console.error("Song database is empty"),null;let t=g;e&&o.playedSongIds.length>0&&(t=g.filter(r=>!o.playedSongIds.includes(r.id)),t.length===0&&(console.log("All songs have been played, resetting played songs list"),o.playedSongIds=[],t=g)),console.log(`Available songs: ${t.length} out of ${g.length} total`);for(let r=0;r<3;r++){const c=Math.floor(Math.random()*t.length),d=t[c],f=`/assets/songs/${d.filename}`,p={id:d.id,title:d.title,artist:d.artist,filename:d.filename,audioUrl:f};try{if((await fetch(p.audioUrl,{method:"HEAD"})).ok)return console.log(`Selected song: "${p.title}" by ${p.artist}`),o.playedSongIds.includes(p.id)||o.playedSongIds.push(p.id),p;console.warn(`Audio file not accessible: ${d.filename} (attempt ${r+1})`)}catch(b){console.warn(`Failed to check audio file: ${d.filename} (attempt ${r+1})`,b)}}console.warn("Could not verify any audio files, proceeding with last selected song");const n=t[Math.floor(Math.random()*t.length)],s=`/assets/songs/${n.filename}`,i={id:n.id,title:n.title,artist:n.artist,filename:n.filename,audioUrl:s};return o.playedSongIds.includes(i.id)||o.playedSongIds.push(i.id),i}function k(){return o.snippetLengths[o.currentSnippetIndex]}function ye(){const e=o.currentSnippetIndex+1;return e<o.snippetLengths.length?o.snippetLengths[e]:null}async function ne(){o.currentTurn=0,o.currentSnippetIndex=0,o.guessedSongs=[],o.status="playing",o.gameStartTime=null,o.gameEndTime=null,o.isPlaying=!1,L();const e=document.getElementById("guess-input");e&&(e.value="",e.disabled=!1,e.style.opacity="1"),l.lastQuery="",l.filteredSongs=[],l.currentHighlight=-1,l.isVisible=!1,y();const t=await te();if(!t){console.error("No songs available in database");return}o.currentSong=t,console.log("New game initialized with song:",o.currentSong.title,"by",o.currentSong.artist);try{await u.loadAudio(o.currentSong.audioUrl),console.log("Audio loaded successfully for:",o.currentSong.title)}catch(n){console.error("Failed to load audio:",n)}S()}async function se(e){o.currentTurn=0,o.currentSnippetIndex=0,o.guessedSongs=[],o.status="playing",o.isPlaying=!1,L();const t=document.getElementById("guess-input");t&&(t.value="",t.disabled=!1,t.style.opacity="1"),l.lastQuery="",l.filteredSongs=[],l.currentHighlight=-1,l.isVisible=!1,y();const n=await te(!0);if(!n){console.error("No songs available in database");return}o.currentSong=n,console.log("Next round initialized with new song:",o.currentSong.title,"by",o.currentSong.artist),console.log("Played songs so far:",o.playedSongIds.length,"out of",g.length);try{await u.loadAudio(o.currentSong.audioUrl),console.log("Audio loaded successfully for next round:",o.currentSong.title)}catch(s){console.error("Failed to load audio:",s)}S()}function V(){o.gameStartTime=new Date,console.log("Game timer started at:",o.gameStartTime)}function Se(){o.gameEndTime=new Date,console.log("Game timer stopped at:",o.gameEndTime)}function ve(){if(!o.gameStartTime)return 0;const e=o.gameEndTime||new Date;return Math.floor((e-o.gameStartTime)/1e3)}function oe(){return o.currentTurn<o.maxTurns-1?(o.currentTurn++,console.log(`Progressed to turn ${o.currentTurn+1}, snippet length remains: ${k()}s`),S(),!0):(o.status="lost",console.log("Game over - no more turns remaining"),S(),!1)}function ke(){return o.currentSnippetIndex<o.snippetLengths.length-1?(o.currentSnippetIndex++,console.log(`Snippet length increased to: ${k()}s`),v&&v.animateMarkerTransition&&v.animateMarkerTransition(),!0):(console.log("Already at maximum snippet length"),!1)}function be(e){const t=e.trim();if(!t||o.status!=="playing")return!1;const n=o.currentSong.title,s=o.currentSong.artist,i=Ee(t,n,s),r={guess:t,turn:o.currentTurn+1,isCorrect:i,snippetLength:k()};if(o.guessedSongs.push(r),console.log(`Guess processed: "${t}" - ${i?"CORRECT":"INCORRECT"}`),i)o.status="won",Se(),console.log("🎉 Correct guess! Player wins!"),u.stopPlayback(),M("correct-guess",`🎉 Correct! "${n}" by ${s}`),setTimeout(()=>{console.log("🎯 Triggering scroll after correct guess"),C()},300),setTimeout(()=>{Ye()},2e3);else{console.log("❌ Incorrect guess! Starting error sequence with animations then scroll");const c=Le(t);let d;c?d=`${c.artist} - ${c.title}`:d=Ie(t),M("incorrect-guess",d),$e(),setTimeout(()=>{console.log("🎯 Triggering scroll after incorrect guess animations"),C()},700),oe()||setTimeout(()=>{o.status="lost",setTimeout(()=>{ce()},1200)},700)}return S(),!0}function Le(e){if(g.length===0)return null;const t=s=>s.toLowerCase().trim().replace(/[^\w\s]/g,"").replace(/\s+/g," "),n=t(e);for(const s of g){const i=t(s.title),r=t(s.artist);if(n===i||n===r||n===`${r} ${i}`||n===`${i} ${r}`)return s}for(const s of g){const i=t(s.title),r=t(s.artist),c=`${r} ${i}`;if(n.includes(i)&&i.length>=3||n.includes(r)&&r.length>=3||c.includes(n)&&n.length>=3)return s}return null}function Ie(e){const t=e.trim();if(t.includes(" - "))return t;if(t.includes(" by ")){const n=t.split(" by ");if(n.length===2)return`${n[1].trim()} - ${n[0].trim()}`}else if(t.includes(": ")){const n=t.split(": ");if(n.length===2)return`${n[0].trim()} - ${n[1].trim()}`}return`Unknown Artist - ${t}`}function Ee(e,t,n){const s=p=>p.toLowerCase().trim().replace(/[^\w\s]/g,"").replace(/\s+/g," "),i=s(e),r=s(t),c=s(n),d=`${c} ${r}`,f=`${r} ${c}`;return i===r||i===c||i===d||i===f}function Te(){return o.status!=="playing"?!1:(console.log("Skip action processed"),u.stopPlayback(),M("skipped","Skipped"),setTimeout(()=>{console.log("🎯 Triggering scroll after skip action"),C()},300),ke(),oe()?setTimeout(()=>{o.status==="playing"&&G()},1e3):setTimeout(()=>{o.status="lost",setTimeout(()=>{ce()},250)},300),!0)}function S(){const e=document.getElementById("skip-button"),t=document.getElementById("submit-button"),n=document.getElementById("guess-input");if(!e||!t||!n)return;const s=ye();o.status==="playing"?o.currentTurn<o.maxTurns-1&&s!==null?(e.textContent=`Skip (${s}s)`,e.disabled=!1,e.style.opacity="1"):o.currentTurn<o.maxTurns-1?(e.textContent="Skip (max length)",e.disabled=!1,e.style.opacity="1"):(e.textContent="No more skips",e.disabled=!0,e.style.opacity="0.6"):(e.disabled=!0,e.style.opacity="0.6"),o.status!=="playing"?(n.disabled=!0,n.style.opacity="0.6",n.placeholder=o.status==="won"?"You won!":"Game over",console.log("Input disabled - game not playing")):(n.disabled=!1,n.style.opacity="1",n.placeholder=l.originalPlaceholder,console.log("Input enabled - game is playing")),O(),v&&v.updateMarkerStates&&v.updateMarkerStates(),console.log(`UI Updated - Turn: ${o.currentTurn+1}/${o.maxTurns}, Snippet: ${k()}s, Status: ${o.status}`)}function Be(){const e=new Date,t={year:"numeric",month:"long",day:"numeric"},n=e.toLocaleDateString("en-US",t),s=document.getElementById("footer-date");s&&(s.textContent=n)}function we(){const e=document.getElementById("landing-page");document.body.classList.add("landing-active"),e.classList.add("initial"),setTimeout(()=>{e.classList.remove("initial"),e.classList.add("transitioning")},500),setTimeout(()=>{e.classList.remove("transitioning")},2e3)}function Ae(){const e=document.getElementById("how-to-play-popup");e.dataset.openedFromGear="true",e.classList.remove("hidden")}async function ie(){const e=document.getElementById("landing-page"),t=document.getElementById("game-screen");console.log("Transitioning to game screen..."),document.body.classList.remove("landing-active"),e.classList.add("hidden"),t.classList.remove("hidden"),console.log("Game screen visible, classes:",t.className),u.init(),await ne(),console.log("Game initialized, showing popup in 500ms"),setTimeout(()=>{Pe()},500)}function Pe(){const e=document.getElementById("how-to-play-popup");e.dataset.openedFromGear="game-screen",e.style.opacity="0",e.classList.remove("hidden"),setTimeout(()=>{e.style.transition="opacity 0.3s ease-out",e.style.opacity="1"},50)}async function Ce(){await ie()}function z(){document.getElementById("how-to-play-popup").classList.add("hidden")}function G(){const e=document.getElementById("vinyl-disc"),t=e.querySelector(".vinyl-center"),n=t.querySelector(".play-pause-icon");if(o.status!=="playing")return;if(o.isPlaying||u.isPlaying()){u.stopPlayback(),e.classList.remove("spinning"),t.classList.remove("playing"),n.classList.remove("playing"),o.isPlaying=!1;return}const s=k(),i=0;if(e.classList.add("spinning"),t.classList.add("playing"),n.classList.add("playing"),console.log(`Playing ${s}s snippet from ${i}s`),!u.playSegment(i,s,!1)){e.classList.remove("spinning"),t.classList.remove("playing"),n.classList.remove("playing"),o.isPlaying=!1,console.warn("Failed to play audio segment");return}}function Me(e){if(e.code==="Space"){const t=document.activeElement;t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA")||(e.preventDefault(),G())}}function C(){console.log("🔄 scrollToLatestAttempt called");const e=document.getElementById("feedback-container");if(!e){console.log("❌ Feedback container not found for latest attempt scroll");return}setTimeout(()=>{const t=e.querySelectorAll(".feedback-item"),n=t[t.length-1];if(console.log("📋 Found feedback items:",t.length),n){e.offsetHeight,n.offsetHeight;const s=e.getBoundingClientRect(),i=n.getBoundingClientRect(),r=window.innerHeight,c=window.scrollY+s.top-100;console.log("📍 Scroll calculation:",{feedbackItemsCount:t.length,scrollTarget:c,currentScrollY:window.scrollY,containerTop:s.top,containerBottom:s.bottom,itemTop:i.top,itemBottom:i.bottom,viewportHeight:r}),window.scrollTo({top:Math.max(0,c),behavior:"smooth"}),setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100),console.log("✅ Scrolling to latest attempt initiated (with backup scrollIntoView)")}else console.log("❌ No feedback items found for scrolling")},100)}function $e(){const e=document.getElementById("game-screen"),t=document.querySelector(".game-main"),n=document.querySelector(".vinyl-center");if(!e||!t){console.warn("Could not find game screen or game main element for error animation");return}console.log("🔴 Triggering error animation: content shake + solid red background + vinyl center flash"),t.classList.add("error-horizontal-shake"),e.classList.add("error-background-static"),n&&n.classList.add("error-vinyl-center-flash"),console.log("Added animation classes:",{gameMainClasses:t.className,gameScreenClasses:e.className,vinylCenterClasses:n==null?void 0:n.className}),setTimeout(()=>{t.classList.remove("error-horizontal-shake"),console.log("🔴 Removed shake animation class from content")},500),setTimeout(()=>{e.classList.remove("error-background-static"),console.log("🔴 Removed background static animation class")},500),setTimeout(()=>{n&&(n.classList.remove("error-vinyl-center-flash"),console.log("🔴 Removed vinyl center flash animation class"))},500)}function M(e,t){const n=document.getElementById("feedback-container"),s=document.getElementById("game-screen");if(!n){xe(e,t);return}const i=n.children.length===0;i&&(n.classList.add("visible"),document.body.classList.add("has-feedback"),s&&s.classList.add("has-feedback"));const r=o.currentTurn+1,c=r===o.maxTurns,d=document.createElement("div");if(d.className=`feedback-item ${e} attempt-${r}`,d.textContent=t,e!=="game-over"){const f=document.createElement("div");if(f.className="attempt-number",c)f.textContent="LAST ATTEMPT";else{const p=["","FIRST ATTEMPT","SECOND ATTEMPT","THIRD ATTEMPT","FOURTH ATTEMPT"];f.textContent=p[r]||`ATTEMPT ${r}`}d.appendChild(f)}n.appendChild(d),i?d.style.animationDelay="0.3s":d.style.animationDelay="0.1s",console.log(`Persistent feedback displayed: ${e} - ${t} (Attempt ${r})`)}function xe(e,t){const n=document.getElementById("feedback-display");if(!n)return;const s=document.createElement("div");s.className=`feedback-message ${e}`,s.textContent=t,n.appendChild(s),setTimeout(()=>{s.parentNode&&(s.style.opacity="0",s.style.transform="translateY(-10px)",setTimeout(()=>{s.parentNode&&s.remove()},300))},e==="game-over"||e==="correct-guess"?5e3:3e3);const r=n.querySelectorAll(".feedback-message");r.length>3&&r[0].remove(),console.log(`Legacy feedback displayed: ${e} - ${t}`)}function L(){const e=document.getElementById("feedback-container"),t=document.getElementById("game-screen");e&&(e.innerHTML="",e.classList.remove("visible")),document.body.classList.remove("has-feedback"),t&&t.classList.remove("has-feedback");const n=document.getElementById("feedback-display");n&&(n.innerHTML="")}function He(){o.status==="playing"&&Te()}function N(){const e=document.getElementById("guess-input"),t=e.value.trim();if(o.status!=="playing"||!t)return;if(!B(t)){const s=q(t);U(s);return}be(t),setTimeout(()=>{e&&o.status==="playing"&&(e.value="",e.disabled=!1,e.style.opacity="1",e.style.backgroundColor="#ffffff",e.style.borderColor="",e.style.boxShadow="",e.placeholder=l.originalPlaceholder,l.lastQuery="",l.filteredSongs=[],l.currentHighlight=-1,l.isVisible=!1,y(),e.focus(),e.click(),console.log("Input cleared and search state reset for next guess"),console.log("Input state after reset:",{disabled:e.disabled,value:e.value,focused:document.activeElement===e,backgroundColor:e.style.backgroundColor}))},500)}function De(){ie()}function Ve(){const e=document.getElementById("how-to-play-popup"),t=document.getElementById("game-screen");console.log("Ready button clicked, popup opened from:",e.dataset.openedFromGear),e.dataset.openedFromGear==="true"?z():(e.classList.add("hidden"),e.style.opacity="",e.style.transition="",t.classList.remove("hidden"),console.log("Game screen should now be visible, starting timer"),V())}function ze(){const e=document.getElementById("play-button");e&&e.addEventListener("click",De);const t=document.getElementById("ready-button");t&&t.addEventListener("click",Ve);const n=document.getElementById("vinyl-disc");n&&n.addEventListener("click",G);const s=document.getElementById("skip-button");s&&s.addEventListener("click",He);const i=document.getElementById("submit-button");i&&i.addEventListener("click",N);const r=document.getElementById("reset-button");r&&r.addEventListener("click",Oe);const c=document.getElementById("cancel-reset");c&&c.addEventListener("click",Qe);const d=document.getElementById("confirm-reset");d&&d.addEventListener("click",Ke);const f=document.getElementById("victory-vinyl");f&&f.addEventListener("click",ae);const p=document.getElementById("play-again-button");p&&p.addEventListener("click",Ze);const b=document.getElementById("loss-vinyl");b&&b.addEventListener("click",de);const K=document.getElementById("loss-play-again-button");K&&K.addEventListener("click",it);const Y=document.getElementById("help-button");Y&&Y.addEventListener("click",Ae),document.addEventListener("keydown",rt),document.addEventListener("keydown",Me),document.addEventListener("keydown",Je),document.addEventListener("keydown",ot),document.addEventListener("keydown",lt),document.addEventListener("keydown",pt),document.addEventListener("keyup",ht);const W=document.getElementById("how-to-play-popup");W&&W.addEventListener("click",J);const j=document.getElementById("reset-popup");j&&j.addEventListener("click",J);const X=document.getElementById("search-modal");X&&X.addEventListener("click",at),gt()}async function F(){console.log("Beatle game initializing..."),Be(),ze(),Ge(),ct(),v.init(),await he(),we(),console.log("Phase 7.5: Interactive Search Suggestions & Dynamic Feedback UI initialized")}document.addEventListener("DOMContentLoaded",F);const l={isVisible:!1,currentHighlight:-1,filteredSongs:[],lastQuery:"",originalPlaceholder:"Know it? Search for title/artist…"},a={isVisible:!1,currentHighlight:-1,filteredSongs:[],lastQuery:"",isActive:!1},m={ctrlPressed:!1,kPressed:!1,pressedButtons:new Set};function Ge(){const e=document.getElementById("guess-input");if(e){if(e.dataset.searchInitialized==="true"){console.log("Search box already initialized, skipping");return}e.dataset.searchInitialized="true",e.addEventListener("input",t=>{const n=t.target.value;console.log("Input event fired:",{value:n,disabled:t.target.disabled,gameStatus:o.status}),n.length>100&&(t.target.value=n.substring(0,100)),O(),P(t.target.value)}),e.addEventListener("focus",()=>{e.classList.add("focused"),e.value.trim()&&le()}),e.addEventListener("blur",()=>{e.classList.remove("focused"),setTimeout(()=>{y()},200)}),e.addEventListener("keydown",t=>{if(t.key==="Enter")if(t.preventDefault(),l.isVisible&&l.filteredSongs.length>0)if(l.currentHighlight>=0)$(l.currentHighlight);else{const n=l.filteredSongs.findIndex(s=>!s.isAlreadyGuessed);n>=0&&$(n)}else{const n=e.value.trim();if(n&&o.status==="playing"){const s=B(n);if(s)Q(s),setTimeout(()=>{N()},300);else{const i=q(n);U(i)}}}else t.key==="ArrowDown"?(t.preventDefault(),t.stopPropagation(),l.isVisible&&(console.log("⬇️ ArrowDown pressed - calling navigateSuggestions(1)"),_(1))):t.key==="ArrowUp"?(t.preventDefault(),t.stopPropagation(),l.isVisible&&(console.log("⬆️ ArrowUp pressed - calling navigateSuggestions(-1)"),_(-1))):t.key==="Escape"&&(y(),e.blur())}),qe(),e.addEventListener("click",()=>{console.log("Input clicked, ensuring focus and functionality"),!e.disabled&&o.status==="playing"&&(e.focus(),e.value.trim()&&P(e.value))}),e.addEventListener("keyup",t=>{!e.disabled&&o.status==="playing"&&(console.log("Keyup event:",t.key,"Value:",e.value),P(e.value))})}}function P(e){const t=e.trim();if(console.log("handleSearchInput called with:",{query:e,trimmedQuery:t,gameStatus:o.status,currentTurn:o.currentTurn}),t.length===0){y();const s=document.getElementById("guess-input");s&&(s.placeholder=l.originalPlaceholder);return}if(t===l.lastQuery){console.log("Query unchanged, skipping");return}l.lastQuery=t,l.filteredSongs=re(t),l.currentHighlight=-1;const n=document.getElementById("guess-input");n&&e.length>0&&(n.placeholder=l.originalPlaceholder),console.log("Filtered songs:",l.filteredSongs.length),l.filteredSongs.length>0?(Ne(),le(),console.log("Showing suggestions dropdown")):(y(),console.log("No songs found, hiding suggestions"))}function re(e){if(g.length===0)return[];const t=h(e),n=R();return g.filter(s=>{const i=h(s.title),r=h(s.artist);return i.includes(t)||r.includes(t)}).map(s=>({...s,isAlreadyGuessed:n.includes(s.id)})).slice(0,8)}function h(e){return e.toLowerCase().trim().replace(/[^\w\s]/g,"").replace(/\s+/g," ")}function Ne(){const e=document.getElementById("suggestions-list");e&&(e.innerHTML="",l.filteredSongs.forEach((t,n)=>{const s=document.createElement("div");s.className=t.isAlreadyGuessed?"suggestion-item already-guessed":"suggestion-item",s.dataset.index=n,s.innerHTML=`
      <div class="song-title">${I(t.title)}</div>
      <div class="song-artist">${I(t.artist)}</div>
    `,t.isAlreadyGuessed?s.style.cursor="not-allowed":(s.addEventListener("click",()=>{$(n)}),s.addEventListener("mouseenter",()=>{Fe(n)})),e.appendChild(s)}))}function le(){const e=document.getElementById("search-suggestions");e&&l.filteredSongs.length>0&&(e.classList.add("visible"),l.isVisible=!0,l.currentHighlight=-1,T())}function y(){const e=document.getElementById("search-suggestions");e&&(e.classList.remove("visible"),l.isVisible=!1,l.currentHighlight=-1,T())}function _(e){var t;if(!(!l.isVisible||l.filteredSongs.length===0)){if(console.log("🔍 Navigation called:",{direction:e,currentHighlight:l.currentHighlight,totalSongs:l.filteredSongs.length,songTitles:l.filteredSongs.map(n=>n.title)}),l.currentHighlight===-1)e===1?l.currentHighlight=0:l.currentHighlight=l.filteredSongs.length-1;else{let n=l.currentHighlight+e;n<0?n=l.filteredSongs.length-1:n>=l.filteredSongs.length&&(n=0),l.currentHighlight=n}T(),console.log("🎯 Navigated to index:",l.currentHighlight,"Song:",(t=l.filteredSongs[l.currentHighlight])==null?void 0:t.title)}}function Fe(e){e>=0&&e<l.filteredSongs.length&&(l.currentHighlight=e,T())}function T(){document.querySelectorAll(".suggestion-item").forEach((t,n)=>{n===l.currentHighlight?t.classList.add("highlighted"):t.classList.remove("highlighted")}),Re()}function Re(){const e=document.getElementById("guess-input");if(e){if(l.isVisible&&l.currentHighlight>=0&&l.currentHighlight<l.filteredSongs.length){const t=l.filteredSongs[l.currentHighlight];if(!t.isAlreadyGuessed){const n=`${t.title} - ${t.artist}`;e.placeholder=n;return}}e.placeholder=l.originalPlaceholder}}function $(e){if(e<0||e>=l.filteredSongs.length)return;const t=l.filteredSongs[e];if(t.isAlreadyGuessed)return;const n=document.getElementById("guess-input");n&&(n.value=t.title,O(),Q(t)),y(),n.focus()}function qe(){const e=document.getElementById("search-suggestions");e&&e.addEventListener("mousedown",t=>{t.preventDefault()})}function I(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function R(){return o.guessedSongs.map(e=>{const t=g.find(n=>{const s=h(e.guess),i=h(n.title),r=h(n.artist),c=`${r} ${i}`,d=`${i} ${r}`;return s===i||s===r||s===c||s===d});return t?t.id:null}).filter(e=>e!==null)}function q(e){if(g.length===0)return!1;const t=h(e),n=R(),s=g.find(i=>{const r=h(i.title),c=h(i.artist),d=`${c} ${r}`,f=`${r} ${c}`;return t===r||t===c||t===d||t===f});return s&&n.includes(s.id)}function B(e){if(g.length===0)return null;const t=h(e),n=R();return g.find(s=>{if(n.includes(s.id))return!1;const i=h(s.title),r=h(s.artist),c=`${r} ${i}`,d=`${i} ${r}`;return t===i||t===r||t===c||t===d})}function U(e=!1){const t=document.getElementById("guess-input");if(!t)return;const n=t.placeholder,s=e?"You already guessed this song! Try a different one.":"Please select a song from the dropdown list";t.placeholder=s,t.style.borderColor="#b41c27",t.style.boxShadow="0px 4px 12px rgba(180, 28, 39, 0.3)",setTimeout(()=>{t.placeholder=n,t.style.borderColor="",t.style.boxShadow=""},e?2500:2e3)}function O(){const e=document.getElementById("guess-input"),t=document.getElementById("submit-button");if(!e||!t)return;const n=e.value.trim(),s=n.length>0&&B(n),i=s&&o.status==="playing";t.disabled=!i,t.style.opacity=i?"1":"0.6",o.status!=="playing"?o.status==="won"?(t.textContent="You Won!",t.style.background="#2cb67d"):o.status==="lost"&&(t.textContent="Game Over",t.style.background="#b41c27"):n.length>0&&!s?(t.textContent="Select from list",t.style.background="#b41c27"):(t.textContent="Submit",t.style.background="#2cb67d")}function Ue(){const e=document.getElementById("reset-popup");e&&(e.classList.remove("hidden"),console.log("Reset confirmation popup shown"))}function w(){const e=document.getElementById("reset-popup");e&&(e.classList.add("hidden"),console.log("Reset confirmation popup hidden"))}function Oe(){Ue()}function Qe(){w()}async function Ke(){console.log("Resetting game..."),w(),u.stopPlayback(),L(),await ne(),S(),o.gameStartTime=Date.now(),console.log("Game reset complete")}function Ye(){const e=document.getElementById("victory-screen"),t=document.getElementById("game-screen");e&&t&&(t.classList.add("hidden"),e.classList.remove("hidden"),je(),Xe(),_e(),console.log("Victory screen shown"))}function We(){const e=document.getElementById("victory-screen"),t=document.getElementById("game-screen");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"),console.log("Victory screen hidden"))}function je(){const e=document.getElementById("victory-song-title"),t=document.getElementById("victory-artist"),n=document.getElementById("victory-seconds");if(e&&(e.textContent=o.currentSong.title),t&&(t.textContent=o.currentSong.artist),n){const s=ve(),i=s>0?s:o.gameStartTime?1:0;n.textContent=i,console.log("Victory screen timer:",{gameStartTime:o.gameStartTime,gameEndTime:o.gameEndTime,elapsedTime:s,displayTime:i})}}function Xe(){const e=document.getElementById("victory-vinyl"),t=e==null?void 0:e.querySelector(".vinyl-center");e&&t&&(e.classList.add("spinning"),t.classList.add("playing"),x(!0))}function _e(){o.currentSong.audioUrl&&(u.playSegment(0,null,!0),console.log("Victory screen: Started playing full song"))}function x(e){const t=document.getElementById("victory-vinyl"),n=t==null?void 0:t.querySelector(".play-pause-icon");n&&(e?n.classList.add("playing"):n.classList.remove("playing"))}function ae(){const e=document.getElementById("victory-vinyl"),t=e==null?void 0:e.querySelector(".vinyl-center");!e||!t||(u.isPlaying()?(u.pause(),e.classList.remove("spinning"),t.classList.remove("playing"),x(!1),console.log("Victory track paused")):(u.currentAudio&&u.currentAudio.currentTime>0?u.resume():u.playSegment(0,null,!0),e.classList.add("spinning"),t.classList.add("playing"),x(!0),console.log("Victory track playing/resumed")))}function Je(e){e.code==="Space"&&(document.getElementById("victory-screen").classList.contains("hidden")||(e.preventDefault(),ae()))}async function Ze(){console.log("Starting next round..."),o.currentSong.id,We(),u.stopPlayback(),await se(),S(),L(),V(),console.log("Next round started with new song")}function ce(){const e=document.getElementById("loss-screen"),t=document.getElementById("game-screen");e&&(t&&t.classList.add("hidden"),e.classList.remove("hidden"),tt(),nt(),st(),console.log("Loss screen displayed"))}function et(){const e=document.getElementById("loss-screen"),t=document.getElementById("game-screen");e&&(e.classList.add("hidden"),t&&t.classList.remove("hidden"),u.stopPlayback(),console.log("Loss screen hidden"))}function tt(){const e=document.getElementById("loss-song-title"),t=document.getElementById("loss-artist");e&&t&&(e.textContent=o.currentSong.title,t.textContent=o.currentSong.artist)}function nt(){const e=document.getElementById("loss-vinyl"),t=e==null?void 0:e.querySelector(".vinyl-center");e&&t&&(e.classList.add("spinning"),t.classList.add("playing"),H(!0))}function st(){o.currentSong.audioUrl&&(u.playSegment(0,null,!1),console.log("Loss screen: Started playing full song"))}function H(e){const t=document.getElementById("loss-vinyl"),n=t==null?void 0:t.querySelector(".play-pause-icon");n&&(e?n.classList.add("playing"):n.classList.remove("playing"))}function de(){const e=document.getElementById("loss-vinyl"),t=e==null?void 0:e.querySelector(".vinyl-center");!e||!t||(u.isPlaying()?(u.pause(),e.classList.remove("spinning"),t.classList.remove("playing"),H(!1),console.log("Loss track paused")):(u.currentAudio&&u.currentAudio.currentTime>0?u.resume():u.playSegment(0,null,!1),e.classList.add("spinning"),t.classList.add("playing"),H(!0),console.log("Loss track playing/resumed")))}function ot(e){e.code==="Space"&&(document.getElementById("loss-screen").classList.contains("hidden")||(e.preventDefault(),de()))}async function it(){console.log("Starting next round from loss screen..."),o.currentSong.id,et(),u.stopPlayback(),await se(),S(),L(),V(),console.log("Next round started from loss screen with new song")}function rt(e){if(e.key==="Escape"){if(console.log("Enhanced Escape key pressed"),a.isActive){e.preventDefault(),A(),console.log("Modal search closed via Escape");return}const t=document.getElementById("how-to-play-popup");if(t&&!t.classList.contains("hidden")){e.preventDefault(),z(),console.log("How-to-play popup closed via Escape");return}const n=document.getElementById("reset-popup");if(n&&!n.classList.contains("hidden")){e.preventDefault(),w(),console.log("Reset confirmation popup closed via Escape");return}if(l.isVisible){e.preventDefault(),y();const s=document.getElementById("guess-input");s&&s.blur(),console.log("Search suggestions hidden via Escape");return}console.log("Escape key handled, but no action taken")}}function J(e){if(e.target.classList.contains("popup-overlay")){const t=document.getElementById("how-to-play-popup"),n=document.getElementById("reset-popup");e.target===t?t.dataset.openedFromGear==="true"?z():Ce():e.target===n&&w()}}function lt(e){e.key==="k"&&e.ctrlKey&&(e.preventDefault(),ue())}function at(e){e.target===document.getElementById("search-modal")&&A()}function ue(){const e=document.getElementById("search-modal"),t=document.getElementById("modal-search-input");if(!e||!t||o.status!=="playing")return;e.classList.remove("hidden"),a.isActive=!0;const n=document.getElementById("guess-input");n&&n.value.trim()?(t.value=n.value,ge(n.value)):(t.value="",E()),t.focus(),t.select(),console.log("Modal search opened")}function A(){const e=document.getElementById("search-modal"),t=document.getElementById("modal-search-input");e&&(e.classList.add("hidden"),a.isActive=!1,a.isVisible=!1,a.currentHighlight=-1,a.filteredSongs=[],a.lastQuery="",t&&(t.value=""),E(),pe(),console.log("Modal search closed"))}function ct(){const e=document.getElementById("modal-search-input");e&&(e.addEventListener("input",t=>{ge(t.target.value)}),e.addEventListener("keydown",t=>{if(t.key==="Escape")t.preventDefault(),A();else if(t.key==="Enter")if(t.preventDefault(),a.isVisible&&a.filteredSongs.length>0)if(a.currentHighlight>=0)D(a.currentHighlight);else{const n=a.filteredSongs.findIndex(s=>!s.isAlreadyGuessed);n>=0&&D(n)}else{const n=e.value.trim();if(n){const s=B(n);if(s)fe(s);else{const i=q(n);U(i)}}}else t.key==="ArrowDown"?(t.preventDefault(),a.isVisible&&Z(1)):t.key==="ArrowUp"&&(t.preventDefault(),a.isVisible&&Z(-1))}),console.log("Modal search input initialized"))}function ge(e){const t=e.trim();if(t.length===0){E();return}t!==a.lastQuery&&(a.lastQuery=t,a.filteredSongs=re(t),a.currentHighlight=-1,a.filteredSongs.length>0?(dt(),ut()):E())}function dt(){const e=document.getElementById("modal-suggestions-list");e&&(e.innerHTML="",a.filteredSongs.forEach((t,n)=>{const s=document.createElement("div");s.className="suggestion-item",s.dataset.index=n,t.isAlreadyGuessed&&s.classList.add("already-guessed"),s.innerHTML=`
      <div class="song-title">${I(t.title)}</div>
      <div class="song-artist">${I(t.artist)}${t.isAlreadyGuessed?'<span class="already-guessed-label"> - Already guessed</span>':""}</div>
    `,s.addEventListener("click",()=>{t.isAlreadyGuessed||D(n)}),s.addEventListener("mouseenter",()=>{a.currentHighlight=n,me()}),e.appendChild(s)}))}function ut(){const e=document.getElementById("modal-search-suggestions");e&&(e.classList.remove("hidden"),a.isVisible=!0)}function E(){const e=document.getElementById("modal-search-suggestions");e&&(e.classList.add("hidden"),a.isVisible=!1)}function Z(e){var t;if(a.filteredSongs.length){if(console.log("🔍 Modal navigation called:",{direction:e,currentHighlight:a.currentHighlight,totalSongs:a.filteredSongs.length}),a.currentHighlight===-1)e===1?a.currentHighlight=0:a.currentHighlight=a.filteredSongs.length-1;else{let n=a.currentHighlight+e;n<0?n=a.filteredSongs.length-1:n>=a.filteredSongs.length&&(n=0),a.currentHighlight=n}me(),console.log("🎯 Modal navigated to index:",a.currentHighlight,"Song:",(t=a.filteredSongs[a.currentHighlight])==null?void 0:t.title)}}function me(){document.querySelectorAll("#modal-suggestions-list .suggestion-item").forEach((t,n)=>{n===a.currentHighlight?t.classList.add("highlighted"):t.classList.remove("highlighted")})}function D(e){const t=a.filteredSongs[e];!t||t.isAlreadyGuessed||fe(t)}function fe(e){const t=document.getElementById("guess-input");t&&(t.value=e.title),Q(e),A(),t&&t.focus(),setTimeout(()=>{N()},300)}F();function Q(e){const t=document.getElementById("guess-input");if(!t)return;const n=t.style.borderColor,s=t.style.boxShadow,i=t.style.backgroundColor;t.style.borderColor="#2cb67d",t.style.boxShadow="0px 4px 12px rgba(44, 182, 125, 0.4)",t.style.backgroundColor="rgba(44, 182, 125, 0.1)";const r=t.placeholder;t.placeholder=`✓ Selected: ${e.title} by ${e.artist}`,setTimeout(()=>{t.style.borderColor=n,t.style.boxShadow=s,t.style.backgroundColor=i,t.placeholder=r},250)}function gt(){const e=document.querySelector(".ctrl-hint"),t=document.querySelector(".k-hint");!e||!t||(e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),ee("ctrl",e)}),t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),ee("k",t)}),console.log("Keyboard shortcut buttons initialized"))}function ee(e,t){m.pressedButtons.has(e)?ft(e,t):mt(e,t),m.pressedButtons.has("ctrl")&&m.pressedButtons.has("k")&&setTimeout(()=>{ue(),pe()},200),console.log("Button click:",e,"Pressed buttons:",Array.from(m.pressedButtons))}function mt(e,t){m.pressedButtons.add(e),t.classList.add("pressed"),e==="ctrl"?m.ctrlPressed=!0:e==="k"&&(m.kPressed=!0)}function ft(e,t){m.pressedButtons.delete(e),t.classList.remove("pressed"),e==="ctrl"?m.ctrlPressed=!1:e==="k"&&(m.kPressed=!1)}function pe(){const e=document.querySelector(".ctrl-hint"),t=document.querySelector(".k-hint");e&&e.classList.remove("pressed"),t&&t.classList.remove("pressed"),m.ctrlPressed=!1,m.kPressed=!1,m.pressedButtons.clear()}function pt(e){const t=document.querySelector(".ctrl-hint"),n=document.querySelector(".k-hint");e.key==="Control"&&!m.ctrlPressed&&(m.ctrlPressed=!0,t&&!t.classList.contains("pressed")&&t.classList.add("pressed")),e.key.toLowerCase()==="k"&&!m.kPressed&&(m.kPressed=!0,n&&!n.classList.contains("pressed")&&n.classList.add("pressed"))}function ht(e){const t=document.querySelector(".ctrl-hint"),n=document.querySelector(".k-hint");e.key==="Control"&&(m.ctrlPressed=!1,t&&t.classList.remove("pressed")),e.key.toLowerCase()==="k"&&(m.kPressed=!1,n&&n.classList.remove("pressed"))}F();const v={markers:[],init(){this.markers=document.querySelectorAll(".progress-marker"),this.setupMarkerInteractions(),this.updateMarkerTooltips(),console.log("Progress markers initialized")},setupMarkerInteractions(){this.markers.forEach(e=>{e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.addEventListener("mouseenter",t=>this.handleMarkerHover(t,!0)),e.addEventListener("mouseleave",t=>this.handleMarkerHover(t,!1)),e.addEventListener("click",t=>this.handleMarkerClick(t)),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.handleMarkerClick(t))}),e.addEventListener("focus",t=>this.handleMarkerFocus(t,!0)),e.addEventListener("blur",t=>this.handleMarkerFocus(t,!1))})},handleMarkerHover(e,t){const n=e.currentTarget,s=n.dataset.seconds;t?(this.updateMarkerTooltip(n,s),n.classList.add("marker-hovered")):n.classList.remove("marker-hovered")},handleMarkerFocus(e,t){const n=e.currentTarget,s=n.dataset.seconds;t?(this.updateMarkerTooltip(n,s),n.classList.add("marker-focused")):n.classList.remove("marker-focused")},handleMarkerClick(e){const t=e.currentTarget,n=parseInt(t.dataset.seconds);parseFloat(t.dataset.position),this.announceMarkerAction(n)},updateMarkerTooltip(e,t){const n=e.querySelector(".marker-tooltip");if(!n)return;const s=k(),i=parseInt(t);let r;i<s?r=`${t} seconds`:i===s?r=`Current snippet is ${t} seconds`:r=`${t} seconds`,n.textContent=`${t} seconds`,e.setAttribute("aria-label",r),e.setAttribute("title",r)},getTurnsNeededForSnippet(e){const t=o.snippetLengths,n=o.currentSnippetIndex;for(let s=n;s<t.length;s++)if(t[s]>=e)return s-n;return t.length-n},updateMarkerTooltips(){this.markers.forEach(e=>{const t=e.dataset.seconds;this.updateMarkerTooltip(e,t)})},updateMarkerStates(){const e=k();this.markers.forEach(t=>{const n=parseInt(t.dataset.seconds);t.querySelector(".marker-tick"),t.classList.remove("marker-past","marker-current","marker-available","marker-future","marker-unavailable"),n<e?t.classList.add("marker-past"):n===e?t.classList.add("marker-current"):this.getTurnsNeededForSnippet(n)<=o.maxTurns-o.currentTurn?t.classList.add("marker-future"):t.classList.add("marker-unavailable")}),this.updateMarkerTooltips()},announceMarkerAction(e){const t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=`Marker for ${e} second snippet selected`,document.body.appendChild(t),setTimeout(()=>document.body.removeChild(t),1e3)},animateMarkerTransition(){this.markers.forEach(e=>{e.classList.add("marker-transition"),setTimeout(()=>e.classList.remove("marker-transition"),300)})}};
